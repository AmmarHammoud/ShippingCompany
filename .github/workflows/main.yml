name: ðŸš€ Deploy Laravel to SmarterASP

on:
  push:
    branches:
      - main   # deploy only when pushing to main branch

jobs:
  web-deploy:
    runs-on: ubuntu-latest

    steps:
    - name: ðŸšš Get latest code
      uses: actions/checkout@v4

    # Install dependencies locally, but don't upload vendor
    - name: ðŸ›  Install PHP dependencies (local only)
      run: composer install --no-dev --optimize-autoloader

    - name: âš¡ Cache Laravel
      run: |
        php artisan config:cache
        php artisan route:cache
        php artisan view:cache

    # Upload Laravel core (incremental, vendor excluded)
    - name: ðŸ“‚ Upload Laravel core
      uses: SamKirkland/FTP-Deploy-Action@v4.3.6
      with:
        server: win8117.site4now.net
        username: fastship-001
        password: ${{ secrets.PASSWORD }}  
        local-dir: ./
        server-dir: /site1/shippingcompany/   # adjust to your real server path
        exclude: |
          vendor/**
          node_modules/**
          .git/**
          .github/**
          .env
          tests/**
          storage/framework/cache/data/**
          storage/framework/sessions/**
          storage/framework/views/**

    # Upload only public folder
    - name: ðŸ“‚ Upload public folder
      uses: SamKirkland/FTP-Deploy-Action@v4.3.6
      with:
        server: win8117.site4now.net
        username: fastship-001 
        password: ${{ secrets.PASSWORD }} 
        local-dir: ./public/
        server-dir: /site1/wwwroot/
        exclude: |
          .git/**
          node_modules/**
